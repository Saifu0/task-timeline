{"ast":null,"code":"import date_utils from './date_utils';\nimport { $, createSVG } from './svg_utils';\nimport Bar from './bar';\nimport Arrow from './arrow';\nimport Popup from './popup';\nimport './gantt.scss';\nexport default class Gantt {\n  constructor(wrapper, tasks, options) {\n    this.setup_wrapper(wrapper);\n    this.setup_options(options);\n    this.setup_tasks(tasks); // initialize with default view mode\n\n    this.change_view_mode();\n    this.bind_events();\n  }\n\n  setup_wrapper(element) {\n    let svg_element, wrapper_element; // CSS Selector is passed\n\n    if (typeof element === 'string') {\n      element = document.querySelector(element);\n    } // get the SVGElement\n\n\n    if (element instanceof HTMLElement) {\n      wrapper_element = element;\n      svg_element = element.querySelector('svg');\n    } else if (element instanceof SVGElement) {\n      svg_element = element;\n    } else {\n      throw new TypeError('FrappÃ© Gantt only supports usage of a string CSS selector,' + \" HTML DOM element or SVG DOM element for the 'element' parameter\");\n    } // svg element\n\n\n    if (!svg_element) {\n      // create it\n      this.$svg = createSVG('svg', {\n        append_to: wrapper_element,\n        class: 'gantt'\n      });\n    } else {\n      this.$svg = svg_element;\n      this.$svg.classList.add('gantt');\n    } // wrapper element\n\n\n    this.$container = document.createElement('div');\n    this.$container.classList.add('gantt-container');\n    const parent_element = this.$svg.parentElement;\n    parent_element.appendChild(this.$container);\n    this.$container.appendChild(this.$svg); // popup wrapper\n\n    this.popup_wrapper = document.createElement('div');\n    this.popup_wrapper.classList.add('popup-wrapper');\n    this.$container.appendChild(this.popup_wrapper);\n  }\n\n  setup_options(options) {\n    const default_options = {\n      header_height: 50,\n      column_width: 30,\n      step: 24,\n      view_modes: ['Quarter Day', 'Half Day', 'Day', 'Week', 'Month'],\n      bar_height: 20,\n      bar_corner_radius: 3,\n      arrow_curve: 5,\n      padding: 18,\n      view_mode: 'Day',\n      date_format: 'YYYY-MM-DD',\n      popup_trigger: 'click',\n      custom_popup_html: null\n    };\n    this.options = Object.assign({}, default_options, options);\n  }\n\n  setup_tasks(tasks) {\n    // prepare tasks\n    this.tasks = tasks.map((task, i) => {\n      // convert to Date objects\n      task._start = date_utils.parse(task.start);\n      task._end = date_utils.parse(task.end); // make task invalid if duration too large\n\n      if (date_utils.diff(task._end, task._start, 'year') > 10) {\n        task.end = null;\n      } // cache index\n\n\n      task._index = i; // invalid dates\n\n      if (!task.start && !task.end) {\n        const today = date_utils.today();\n        task._start = today;\n        task._end = date_utils.add(today, 2, 'day');\n      }\n\n      if (!task.start && task.end) {\n        task._start = date_utils.add(task._end, -2, 'day');\n      }\n\n      if (task.start && !task.end) {\n        task._end = date_utils.add(task._start, 2, 'day');\n      } // if hours is not set, assume the last day is full day\n      // e.g: 2018-09-09 becomes 2018-09-09 23:59:59\n\n\n      const task_end_values = date_utils.get_date_values(task._end);\n\n      if (task_end_values.slice(3).every(d => d === 0)) {\n        task._end = date_utils.add(task._end, 24, 'hour');\n      } // invalid flag\n\n\n      if (!task.start || !task.end) {\n        task.invalid = true;\n      } // dependencies\n\n\n      if (typeof task.dependencies === 'string' || !task.dependencies) {\n        let deps = [];\n\n        if (task.dependencies) {\n          deps = task.dependencies.split(',').map(d => d.trim()).filter(d => d);\n        }\n\n        task.dependencies = deps;\n      } // uids\n\n\n      if (!task.id) {\n        task.id = generate_id(task);\n      }\n\n      return task;\n    });\n    this.setup_dependencies();\n  }\n\n  setup_dependencies() {\n    this.dependency_map = {};\n\n    for (let t of this.tasks) {\n      for (let d of t.dependencies) {\n        this.dependency_map[d] = this.dependency_map[d] || [];\n        this.dependency_map[d].push(t.id);\n      }\n    }\n  }\n\n  refresh(tasks) {\n    this.setup_tasks(tasks);\n    this.change_view_mode();\n  }\n\n  change_view_mode(mode = this.options.view_mode) {\n    this.update_view_scale(mode);\n    this.setup_dates();\n    this.render(); // fire viewmode_change event\n\n    this.trigger_event('view_change', [mode]);\n  }\n\n  update_view_scale(view_mode) {\n    this.options.view_mode = view_mode;\n\n    if (view_mode === 'Day') {\n      this.options.step = 24;\n      this.options.column_width = 38;\n    } else if (view_mode === 'Half Day') {\n      this.options.step = 24 / 2;\n      this.options.column_width = 38;\n    } else if (view_mode === 'Quarter Day') {\n      this.options.step = 24 / 4;\n      this.options.column_width = 38;\n    } else if (view_mode === 'Week') {\n      this.options.step = 24 * 7;\n      this.options.column_width = 140;\n    } else if (view_mode === 'Month') {\n      this.options.step = 24 * 30;\n      this.options.column_width = 120;\n    }\n  }\n\n  setup_dates() {\n    this.setup_gantt_dates();\n    this.setup_date_values();\n  }\n\n  setup_gantt_dates() {\n    this.gantt_start = this.gantt_end = null;\n\n    for (let task of this.tasks) {\n      // set global start and end date\n      if (!this.gantt_start || task._start < this.gantt_start) {\n        this.gantt_start = task._start;\n      }\n\n      if (!this.gantt_end || task._end > this.gantt_end) {\n        this.gantt_end = task._end;\n      }\n    }\n\n    this.gantt_start = date_utils.start_of(this.gantt_start, 'day');\n    this.gantt_end = date_utils.start_of(this.gantt_end, 'day'); // add date padding on both sides\n\n    if (this.view_is(['Quarter Day', 'Half Day'])) {\n      this.gantt_start = date_utils.add(this.gantt_start, -7, 'day');\n      this.gantt_end = date_utils.add(this.gantt_end, 7, 'day');\n    } else if (this.view_is('Month')) {\n      this.gantt_start = date_utils.start_of(this.gantt_start, 'year');\n      this.gantt_end = date_utils.add(this.gantt_end, 1, 'year');\n    } else {\n      this.gantt_start = date_utils.add(this.gantt_start, -1, 'month');\n      this.gantt_end = date_utils.add(this.gantt_end, 1, 'month');\n    }\n  }\n\n  setup_date_values() {\n    this.dates = [];\n    let cur_date = null;\n\n    while (cur_date === null || cur_date < this.gantt_end) {\n      if (!cur_date) {\n        cur_date = date_utils.clone(this.gantt_start);\n      } else {\n        cur_date = this.view_is('Month') ? date_utils.add(cur_date, 1, 'month') : date_utils.add(cur_date, this.options.step, 'hour');\n      }\n\n      this.dates.push(cur_date);\n    }\n  }\n\n  bind_events() {\n    this.bind_grid_click();\n    this.bind_bar_events();\n  }\n\n  render() {\n    this.clear();\n    this.setup_layers();\n    this.make_grid();\n    this.make_dates();\n    this.make_bars();\n    this.make_arrows();\n    this.map_arrows_on_bars();\n    this.set_width();\n    this.set_scroll_position();\n  }\n\n  setup_layers() {\n    this.layers = {};\n    const layers = ['grid', 'date', 'arrow', 'progress', 'bar', 'details']; // make group layers\n\n    for (let layer of layers) {\n      this.layers[layer] = createSVG('g', {\n        class: layer,\n        append_to: this.$svg\n      });\n    }\n  }\n\n  make_grid() {\n    this.make_grid_background();\n    this.make_grid_rows();\n    this.make_grid_header();\n    this.make_grid_ticks();\n    this.make_grid_highlights();\n  }\n\n  make_grid_background() {\n    const grid_width = this.dates.length * this.options.column_width;\n    const grid_height = this.options.header_height + this.options.padding + (this.options.bar_height + this.options.padding) * this.tasks.length;\n    createSVG('rect', {\n      x: 0,\n      y: 0,\n      width: grid_width,\n      height: grid_height,\n      class: 'grid-background',\n      append_to: this.layers.grid\n    });\n    $.attr(this.$svg, {\n      height: grid_height + this.options.padding + 100,\n      width: '100%'\n    });\n  }\n\n  make_grid_rows() {\n    const rows_layer = createSVG('g', {\n      append_to: this.layers.grid\n    });\n    const lines_layer = createSVG('g', {\n      append_to: this.layers.grid\n    });\n    const row_width = this.dates.length * this.options.column_width;\n    const row_height = this.options.bar_height + this.options.padding;\n    let row_y = this.options.header_height + this.options.padding / 2;\n\n    for (let task of this.tasks) {\n      createSVG('rect', {\n        x: 0,\n        y: row_y,\n        width: row_width,\n        height: row_height,\n        class: 'grid-row',\n        append_to: rows_layer\n      });\n      createSVG('line', {\n        x1: 0,\n        y1: row_y + row_height,\n        x2: row_width,\n        y2: row_y + row_height,\n        class: 'row-line',\n        append_to: lines_layer\n      });\n      row_y += this.options.bar_height + this.options.padding;\n    }\n  }\n\n  make_grid_header() {\n    const header_width = this.dates.length * this.options.column_width;\n    const header_height = this.options.header_height + 10;\n    createSVG('rect', {\n      x: 0,\n      y: 0,\n      width: header_width,\n      height: header_height,\n      class: 'grid-header',\n      append_to: this.layers.grid\n    });\n  }\n\n  make_grid_ticks() {\n    let tick_x = 0;\n    let tick_y = this.options.header_height + this.options.padding / 2;\n    let tick_height = (this.options.bar_height + this.options.padding) * this.tasks.length;\n\n    for (let date of this.dates) {\n      let tick_class = 'tick'; // thick tick for monday\n\n      if (this.view_is('Day') && date.getDate() === 1) {\n        tick_class += ' thick';\n      } // thick tick for first week\n\n\n      if (this.view_is('Week') && date.getDate() >= 1 && date.getDate() < 8) {\n        tick_class += ' thick';\n      } // thick ticks for quarters\n\n\n      if (this.view_is('Month') && (date.getMonth() + 1) % 3 === 0) {\n        tick_class += ' thick';\n      }\n\n      createSVG('path', {\n        d: `M ${tick_x} ${tick_y} v ${tick_height}`,\n        class: tick_class,\n        append_to: this.layers.grid\n      });\n\n      if (this.view_is('Month')) {\n        tick_x += date_utils.get_days_in_month(date) * this.options.column_width / 30;\n      } else {\n        tick_x += this.options.column_width;\n      }\n    }\n  }\n\n  make_grid_highlights() {\n    // highlight today's date\n    if (this.view_is('Day')) {\n      const x = date_utils.diff(date_utils.today(), this.gantt_start, 'hour') / this.options.step * this.options.column_width;\n      const y = 0;\n      const width = this.options.column_width;\n      const height = (this.options.bar_height + this.options.padding) * this.tasks.length + this.options.header_height + this.options.padding / 2;\n      createSVG('rect', {\n        x,\n        y,\n        width,\n        height,\n        class: 'today-highlight',\n        append_to: this.layers.grid\n      });\n    }\n  }\n\n  make_dates() {\n    for (let date of this.get_dates_to_draw()) {\n      createSVG('text', {\n        x: date.lower_x,\n        y: date.lower_y,\n        innerHTML: date.lower_text,\n        class: 'lower-text',\n        append_to: this.layers.date\n      });\n\n      if (date.upper_text) {\n        const $upper_text = createSVG('text', {\n          x: date.upper_x,\n          y: date.upper_y,\n          innerHTML: date.upper_text,\n          class: 'upper-text',\n          append_to: this.layers.date\n        }); // remove out-of-bound dates\n\n        if ($upper_text.getBBox().x2 > this.layers.grid.getBBox().width) {\n          $upper_text.remove();\n        }\n      }\n    }\n  }\n\n  get_dates_to_draw() {\n    let last_date = null;\n    const dates = this.dates.map((date, i) => {\n      const d = this.get_date_info(date, last_date, i);\n      last_date = date;\n      return d;\n    });\n    return dates;\n  }\n\n  get_date_info(date, last_date, i) {\n    if (!last_date) {\n      last_date = date_utils.add(date, 1, 'year');\n    }\n\n    const date_text = {\n      'Quarter Day_lower': date_utils.format(date, 'HH'),\n      'Half Day_lower': date_utils.format(date, 'HH'),\n      Day_lower: date.getDate() !== last_date.getDate() ? date_utils.format(date, 'D') : '',\n      Week_lower: date.getMonth() !== last_date.getMonth() ? date_utils.format(date, 'D MMM') : date_utils.format(date, 'D'),\n      Month_lower: date_utils.format(date, 'MMMM'),\n      'Quarter Day_upper': date.getDate() !== last_date.getDate() ? date_utils.format(date, 'D MMM') : '',\n      'Half Day_upper': date.getDate() !== last_date.getDate() ? date.getMonth() !== last_date.getMonth() ? date_utils.format(date, 'D MMM') : date_utils.format(date, 'D') : '',\n      Day_upper: date.getMonth() !== last_date.getMonth() ? date_utils.format(date, 'MMMM') : '',\n      Week_upper: date.getMonth() !== last_date.getMonth() ? date_utils.format(date, 'MMMM') : '',\n      Month_upper: date.getFullYear() !== last_date.getFullYear() ? date_utils.format(date, 'YYYY') : ''\n    };\n    const base_pos = {\n      x: i * this.options.column_width,\n      lower_y: this.options.header_height,\n      upper_y: this.options.header_height - 25\n    };\n    const x_pos = {\n      'Quarter Day_lower': this.options.column_width * 4 / 2,\n      'Quarter Day_upper': 0,\n      'Half Day_lower': this.options.column_width * 2 / 2,\n      'Half Day_upper': 0,\n      Day_lower: this.options.column_width / 2,\n      Day_upper: this.options.column_width * 30 / 2,\n      Week_lower: 0,\n      Week_upper: this.options.column_width * 4 / 2,\n      Month_lower: this.options.column_width / 2,\n      Month_upper: this.options.column_width * 12 / 2\n    };\n    return {\n      upper_text: date_text[`${this.options.view_mode}_upper`],\n      lower_text: date_text[`${this.options.view_mode}_lower`],\n      upper_x: base_pos.x + x_pos[`${this.options.view_mode}_upper`],\n      upper_y: base_pos.upper_y,\n      lower_x: base_pos.x + x_pos[`${this.options.view_mode}_lower`],\n      lower_y: base_pos.lower_y\n    };\n  }\n\n  make_bars() {\n    this.bars = this.tasks.map(task => {\n      const bar = new Bar(this, task);\n      this.layers.bar.appendChild(bar.group);\n      return bar;\n    });\n  }\n\n  make_arrows() {\n    this.arrows = [];\n\n    for (let task of this.tasks) {\n      let arrows = [];\n      arrows = task.dependencies.map(task_id => {\n        const dependency = this.get_task(task_id);\n        if (!dependency) return;\n        const arrow = new Arrow(this, this.bars[dependency._index], // from_task\n        this.bars[task._index] // to_task\n        );\n        this.layers.arrow.appendChild(arrow.element);\n        return arrow;\n      }).filter(Boolean); // filter falsy values\n\n      this.arrows = this.arrows.concat(arrows);\n    }\n  }\n\n  map_arrows_on_bars() {\n    for (let bar of this.bars) {\n      bar.arrows = this.arrows.filter(arrow => {\n        return arrow.from_task.task.id === bar.task.id || arrow.to_task.task.id === bar.task.id;\n      });\n    }\n  }\n\n  set_width() {\n    const cur_width = this.$svg.getBoundingClientRect().width;\n    const actual_width = this.$svg.querySelector('.grid .grid-row').getAttribute('width');\n\n    if (cur_width < actual_width) {\n      this.$svg.setAttribute('width', actual_width);\n    }\n  }\n\n  set_scroll_position() {\n    const parent_element = this.$svg.parentElement;\n    if (!parent_element) return;\n    const hours_before_first_task = date_utils.diff(this.get_oldest_starting_date(), this.gantt_start, 'hour');\n    const scroll_pos = hours_before_first_task / this.options.step * this.options.column_width - this.options.column_width;\n    parent_element.scrollLeft = scroll_pos;\n  }\n\n  bind_grid_click() {\n    $.on(this.$svg, this.options.popup_trigger, '.grid-row, .grid-header', () => {\n      this.unselect_all();\n      this.hide_popup();\n    });\n  }\n\n  bind_bar_events() {\n    let is_dragging = false;\n    let x_on_start = 0;\n    let y_on_start = 0;\n    let is_resizing_left = false;\n    let is_resizing_right = false;\n    let parent_bar_id = null;\n    let bars = []; // instanceof Bar\n\n    this.bar_being_dragged = null;\n\n    function action_in_progress() {\n      return is_dragging || is_resizing_left || is_resizing_right;\n    }\n\n    $.on(this.$svg, 'mousedown', '.bar-wrapper, .handle', (e, element) => {\n      const bar_wrapper = $.closest('.bar-wrapper', element);\n\n      if (element.classList.contains('left')) {\n        is_resizing_left = true;\n      } else if (element.classList.contains('right')) {\n        is_resizing_right = true;\n      } else if (element.classList.contains('bar-wrapper')) {\n        is_dragging = true;\n      }\n\n      bar_wrapper.classList.add('active');\n      x_on_start = e.offsetX;\n      y_on_start = e.offsetY;\n      parent_bar_id = bar_wrapper.getAttribute('data-id');\n      const ids = [parent_bar_id, ...this.get_all_dependent_tasks(parent_bar_id)];\n      bars = ids.map(id => this.get_bar(id));\n      this.bar_being_dragged = parent_bar_id;\n      bars.forEach(bar => {\n        const $bar = bar.$bar;\n        $bar.ox = $bar.getX();\n        $bar.oy = $bar.getY();\n        $bar.owidth = $bar.getWidth();\n        $bar.finaldx = 0;\n      });\n    });\n    $.on(this.$svg, 'mousemove', e => {\n      if (!action_in_progress()) return;\n      const dx = e.offsetX - x_on_start;\n      const dy = e.offsetY - y_on_start;\n      bars.forEach(bar => {\n        const $bar = bar.$bar;\n        $bar.finaldx = this.get_snap_position(dx);\n\n        if (is_resizing_left) {\n          if (parent_bar_id === bar.task.id) {\n            bar.update_bar_position({\n              x: $bar.ox + $bar.finaldx,\n              width: $bar.owidth - $bar.finaldx\n            });\n          } else {\n            bar.update_bar_position({\n              x: $bar.ox + $bar.finaldx\n            });\n          }\n        } else if (is_resizing_right) {\n          if (parent_bar_id === bar.task.id) {\n            bar.update_bar_position({\n              width: $bar.owidth + $bar.finaldx\n            });\n          }\n        } else if (is_dragging) {\n          bar.update_bar_position({\n            x: $bar.ox + $bar.finaldx\n          });\n        }\n      });\n    });\n    document.addEventListener('mouseup', e => {\n      if (is_dragging || is_resizing_left || is_resizing_right) {\n        bars.forEach(bar => bar.group.classList.remove('active'));\n      }\n\n      is_dragging = false;\n      is_resizing_left = false;\n      is_resizing_right = false;\n    });\n    $.on(this.$svg, 'mouseup', e => {\n      this.bar_being_dragged = null;\n      bars.forEach(bar => {\n        const $bar = bar.$bar;\n        if (!$bar.finaldx) return;\n        bar.date_changed();\n        bar.set_action_completed();\n      });\n    });\n    this.bind_bar_progress();\n  }\n\n  bind_bar_progress() {\n    let x_on_start = 0;\n    let y_on_start = 0;\n    let is_resizing = null;\n    let bar = null;\n    let $bar_progress = null;\n    let $bar = null;\n    $.on(this.$svg, 'mousedown', '.handle.progress', (e, handle) => {\n      is_resizing = true;\n      x_on_start = e.offsetX;\n      y_on_start = e.offsetY;\n      const $bar_wrapper = $.closest('.bar-wrapper', handle);\n      const id = $bar_wrapper.getAttribute('data-id');\n      bar = this.get_bar(id);\n      $bar_progress = bar.$bar_progress;\n      $bar = bar.$bar;\n      $bar_progress.finaldx = 0;\n      $bar_progress.owidth = $bar_progress.getWidth();\n      $bar_progress.min_dx = -$bar_progress.getWidth();\n      $bar_progress.max_dx = $bar.getWidth() - $bar_progress.getWidth();\n    });\n    $.on(this.$svg, 'mousemove', e => {\n      if (!is_resizing) return;\n      let dx = e.offsetX - x_on_start;\n      let dy = e.offsetY - y_on_start;\n\n      if (dx > $bar_progress.max_dx) {\n        dx = $bar_progress.max_dx;\n      }\n\n      if (dx < $bar_progress.min_dx) {\n        dx = $bar_progress.min_dx;\n      }\n\n      const $handle = bar.$handle_progress;\n      $.attr($bar_progress, 'width', $bar_progress.owidth + dx);\n      $.attr($handle, 'points', bar.get_progress_polygon_points());\n      $bar_progress.finaldx = dx;\n    });\n    $.on(this.$svg, 'mouseup', () => {\n      is_resizing = false;\n      if (!($bar_progress && $bar_progress.finaldx)) return;\n      bar.progress_changed();\n      bar.set_action_completed();\n    });\n  }\n\n  get_all_dependent_tasks(task_id) {\n    let out = [];\n    let to_process = [task_id];\n\n    while (to_process.length) {\n      const deps = to_process.reduce((acc, curr) => {\n        acc = acc.concat(this.dependency_map[curr]);\n        return acc;\n      }, []);\n      out = out.concat(deps);\n      to_process = deps.filter(d => !to_process.includes(d));\n    }\n\n    return out.filter(Boolean);\n  }\n\n  get_snap_position(dx) {\n    let odx = dx,\n        rem,\n        position;\n\n    if (this.view_is('Week')) {\n      rem = dx % (this.options.column_width / 7);\n      position = odx - rem + (rem < this.options.column_width / 14 ? 0 : this.options.column_width / 7);\n    } else if (this.view_is('Month')) {\n      rem = dx % (this.options.column_width / 30);\n      position = odx - rem + (rem < this.options.column_width / 60 ? 0 : this.options.column_width / 30);\n    } else {\n      rem = dx % this.options.column_width;\n      position = odx - rem + (rem < this.options.column_width / 2 ? 0 : this.options.column_width);\n    }\n\n    return position;\n  }\n\n  unselect_all() {\n    [...this.$svg.querySelectorAll('.bar-wrapper')].forEach(el => {\n      el.classList.remove('active');\n    });\n  }\n\n  view_is(modes) {\n    if (typeof modes === 'string') {\n      return this.options.view_mode === modes;\n    }\n\n    if (Array.isArray(modes)) {\n      return modes.some(mode => this.options.view_mode === mode);\n    }\n\n    return false;\n  }\n\n  get_task(id) {\n    return this.tasks.find(task => {\n      return task.id === id;\n    });\n  }\n\n  get_bar(id) {\n    return this.bars.find(bar => {\n      return bar.task.id === id;\n    });\n  }\n\n  show_popup(options) {\n    if (!this.popup) {\n      this.popup = new Popup(this.popup_wrapper, this.options.custom_popup_html);\n    }\n\n    this.popup.show(options);\n  }\n\n  hide_popup() {\n    this.popup && this.popup.hide();\n  }\n\n  trigger_event(event, args) {\n    if (this.options['on_' + event]) {\n      this.options['on_' + event].apply(null, args);\n    }\n  }\n  /**\n   * Gets the oldest starting date from the list of tasks\n   *\n   * @returns Date\n   * @memberof Gantt\n   */\n\n\n  get_oldest_starting_date() {\n    return this.tasks.map(task => task._start).reduce((prev_date, cur_date) => cur_date <= prev_date ? cur_date : prev_date);\n  }\n  /**\n   * Clear all elements from the parent svg element\n   *\n   * @memberof Gantt\n   */\n\n\n  clear() {\n    this.$svg.innerHTML = '';\n  }\n\n}\n\nfunction generate_id(task) {\n  return task.name + '_' + Math.random().toString(36).slice(2, 12);\n}","map":{"version":3,"sources":["/home/saifu/Documents/pikkal/timeline/frontend/node_modules/frappe-gantt/src/index.js"],"names":["date_utils","$","createSVG","Bar","Arrow","Popup","Gantt","constructor","wrapper","tasks","options","setup_wrapper","setup_options","setup_tasks","change_view_mode","bind_events","element","svg_element","wrapper_element","document","querySelector","HTMLElement","SVGElement","TypeError","$svg","append_to","class","classList","add","$container","createElement","parent_element","parentElement","appendChild","popup_wrapper","default_options","header_height","column_width","step","view_modes","bar_height","bar_corner_radius","arrow_curve","padding","view_mode","date_format","popup_trigger","custom_popup_html","Object","assign","map","task","i","_start","parse","start","_end","end","diff","_index","today","task_end_values","get_date_values","slice","every","d","invalid","dependencies","deps","split","trim","filter","id","generate_id","setup_dependencies","dependency_map","t","push","refresh","mode","update_view_scale","setup_dates","render","trigger_event","setup_gantt_dates","setup_date_values","gantt_start","gantt_end","start_of","view_is","dates","cur_date","clone","bind_grid_click","bind_bar_events","clear","setup_layers","make_grid","make_dates","make_bars","make_arrows","map_arrows_on_bars","set_width","set_scroll_position","layers","layer","make_grid_background","make_grid_rows","make_grid_header","make_grid_ticks","make_grid_highlights","grid_width","length","grid_height","x","y","width","height","grid","attr","rows_layer","lines_layer","row_width","row_height","row_y","x1","y1","x2","y2","header_width","tick_x","tick_y","tick_height","date","tick_class","getDate","getMonth","get_days_in_month","get_dates_to_draw","lower_x","lower_y","innerHTML","lower_text","upper_text","$upper_text","upper_x","upper_y","getBBox","remove","last_date","get_date_info","date_text","format","Day_lower","Week_lower","Month_lower","Day_upper","Week_upper","Month_upper","getFullYear","base_pos","x_pos","bars","bar","group","arrows","task_id","dependency","get_task","arrow","Boolean","concat","from_task","to_task","cur_width","getBoundingClientRect","actual_width","getAttribute","setAttribute","hours_before_first_task","get_oldest_starting_date","scroll_pos","scrollLeft","on","unselect_all","hide_popup","is_dragging","x_on_start","y_on_start","is_resizing_left","is_resizing_right","parent_bar_id","bar_being_dragged","action_in_progress","e","bar_wrapper","closest","contains","offsetX","offsetY","ids","get_all_dependent_tasks","get_bar","forEach","$bar","ox","getX","oy","getY","owidth","getWidth","finaldx","dx","dy","get_snap_position","update_bar_position","addEventListener","date_changed","set_action_completed","bind_bar_progress","is_resizing","$bar_progress","handle","$bar_wrapper","min_dx","max_dx","$handle","$handle_progress","get_progress_polygon_points","progress_changed","out","to_process","reduce","acc","curr","includes","odx","rem","position","querySelectorAll","el","modes","Array","isArray","some","find","show_popup","popup","show","hide","event","args","apply","prev_date","name","Math","random","toString"],"mappings":"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","sourcesContent":["import date_utils from './date_utils';\nimport { $, createSVG } from './svg_utils';\nimport Bar from './bar';\nimport Arrow from './arrow';\nimport Popup from './popup';\n\nimport './gantt.scss';\n\nexport default class Gantt {\n    constructor(wrapper, tasks, options) {\n        this.setup_wrapper(wrapper);\n        this.setup_options(options);\n        this.setup_tasks(tasks);\n        // initialize with default view mode\n        this.change_view_mode();\n        this.bind_events();\n    }\n\n    setup_wrapper(element) {\n        let svg_element, wrapper_element;\n\n        // CSS Selector is passed\n        if (typeof element === 'string') {\n            element = document.querySelector(element);\n        }\n\n        // get the SVGElement\n        if (element instanceof HTMLElement) {\n            wrapper_element = element;\n            svg_element = element.querySelector('svg');\n        } else if (element instanceof SVGElement) {\n            svg_element = element;\n        } else {\n            throw new TypeError(\n                'FrappÃ© Gantt only supports usage of a string CSS selector,' +\n                    \" HTML DOM element or SVG DOM element for the 'element' parameter\"\n            );\n        }\n\n        // svg element\n        if (!svg_element) {\n            // create it\n            this.$svg = createSVG('svg', {\n                append_to: wrapper_element,\n                class: 'gantt'\n            });\n        } else {\n            this.$svg = svg_element;\n            this.$svg.classList.add('gantt');\n        }\n\n        // wrapper element\n        this.$container = document.createElement('div');\n        this.$container.classList.add('gantt-container');\n\n        const parent_element = this.$svg.parentElement;\n        parent_element.appendChild(this.$container);\n        this.$container.appendChild(this.$svg);\n\n        // popup wrapper\n        this.popup_wrapper = document.createElement('div');\n        this.popup_wrapper.classList.add('popup-wrapper');\n        this.$container.appendChild(this.popup_wrapper);\n    }\n\n    setup_options(options) {\n        const default_options = {\n            header_height: 50,\n            column_width: 30,\n            step: 24,\n            view_modes: ['Quarter Day', 'Half Day', 'Day', 'Week', 'Month'],\n            bar_height: 20,\n            bar_corner_radius: 3,\n            arrow_curve: 5,\n            padding: 18,\n            view_mode: 'Day',\n            date_format: 'YYYY-MM-DD',\n            popup_trigger: 'click',\n            custom_popup_html: null\n        };\n        this.options = Object.assign({}, default_options, options);\n    }\n\n    setup_tasks(tasks) {\n        // prepare tasks\n        this.tasks = tasks.map((task, i) => {\n            // convert to Date objects\n            task._start = date_utils.parse(task.start);\n            task._end = date_utils.parse(task.end);\n\n            // make task invalid if duration too large\n            if (date_utils.diff(task._end, task._start, 'year') > 10) {\n                task.end = null;\n            }\n\n            // cache index\n            task._index = i;\n\n            // invalid dates\n            if (!task.start && !task.end) {\n                const today = date_utils.today();\n                task._start = today;\n                task._end = date_utils.add(today, 2, 'day');\n            }\n\n            if (!task.start && task.end) {\n                task._start = date_utils.add(task._end, -2, 'day');\n            }\n\n            if (task.start && !task.end) {\n                task._end = date_utils.add(task._start, 2, 'day');\n            }\n\n            // if hours is not set, assume the last day is full day\n            // e.g: 2018-09-09 becomes 2018-09-09 23:59:59\n            const task_end_values = date_utils.get_date_values(task._end);\n            if (task_end_values.slice(3).every(d => d === 0)) {\n                task._end = date_utils.add(task._end, 24, 'hour');\n            }\n\n            // invalid flag\n            if (!task.start || !task.end) {\n                task.invalid = true;\n            }\n\n            // dependencies\n            if (typeof task.dependencies === 'string' || !task.dependencies) {\n                let deps = [];\n                if (task.dependencies) {\n                    deps = task.dependencies\n                        .split(',')\n                        .map(d => d.trim())\n                        .filter(d => d);\n                }\n                task.dependencies = deps;\n            }\n\n            // uids\n            if (!task.id) {\n                task.id = generate_id(task);\n            }\n\n            return task;\n        });\n\n        this.setup_dependencies();\n    }\n\n    setup_dependencies() {\n        this.dependency_map = {};\n        for (let t of this.tasks) {\n            for (let d of t.dependencies) {\n                this.dependency_map[d] = this.dependency_map[d] || [];\n                this.dependency_map[d].push(t.id);\n            }\n        }\n    }\n\n    refresh(tasks) {\n        this.setup_tasks(tasks);\n        this.change_view_mode();\n    }\n\n    change_view_mode(mode = this.options.view_mode) {\n        this.update_view_scale(mode);\n        this.setup_dates();\n        this.render();\n        // fire viewmode_change event\n        this.trigger_event('view_change', [mode]);\n    }\n\n    update_view_scale(view_mode) {\n        this.options.view_mode = view_mode;\n\n        if (view_mode === 'Day') {\n            this.options.step = 24;\n            this.options.column_width = 38;\n        } else if (view_mode === 'Half Day') {\n            this.options.step = 24 / 2;\n            this.options.column_width = 38;\n        } else if (view_mode === 'Quarter Day') {\n            this.options.step = 24 / 4;\n            this.options.column_width = 38;\n        } else if (view_mode === 'Week') {\n            this.options.step = 24 * 7;\n            this.options.column_width = 140;\n        } else if (view_mode === 'Month') {\n            this.options.step = 24 * 30;\n            this.options.column_width = 120;\n        }\n    }\n\n    setup_dates() {\n        this.setup_gantt_dates();\n        this.setup_date_values();\n    }\n\n    setup_gantt_dates() {\n        this.gantt_start = this.gantt_end = null;\n\n        for (let task of this.tasks) {\n            // set global start and end date\n            if (!this.gantt_start || task._start < this.gantt_start) {\n                this.gantt_start = task._start;\n            }\n            if (!this.gantt_end || task._end > this.gantt_end) {\n                this.gantt_end = task._end;\n            }\n        }\n\n        this.gantt_start = date_utils.start_of(this.gantt_start, 'day');\n        this.gantt_end = date_utils.start_of(this.gantt_end, 'day');\n\n        // add date padding on both sides\n        if (this.view_is(['Quarter Day', 'Half Day'])) {\n            this.gantt_start = date_utils.add(this.gantt_start, -7, 'day');\n            this.gantt_end = date_utils.add(this.gantt_end, 7, 'day');\n        } else if (this.view_is('Month')) {\n            this.gantt_start = date_utils.start_of(this.gantt_start, 'year');\n            this.gantt_end = date_utils.add(this.gantt_end, 1, 'year');\n        } else {\n            this.gantt_start = date_utils.add(this.gantt_start, -1, 'month');\n            this.gantt_end = date_utils.add(this.gantt_end, 1, 'month');\n        }\n    }\n\n    setup_date_values() {\n        this.dates = [];\n        let cur_date = null;\n\n        while (cur_date === null || cur_date < this.gantt_end) {\n            if (!cur_date) {\n                cur_date = date_utils.clone(this.gantt_start);\n            } else {\n                cur_date = this.view_is('Month')\n                    ? date_utils.add(cur_date, 1, 'month')\n                    : date_utils.add(cur_date, this.options.step, 'hour');\n            }\n            this.dates.push(cur_date);\n        }\n    }\n\n    bind_events() {\n        this.bind_grid_click();\n        this.bind_bar_events();\n    }\n\n    render() {\n        this.clear();\n        this.setup_layers();\n        this.make_grid();\n        this.make_dates();\n        this.make_bars();\n        this.make_arrows();\n        this.map_arrows_on_bars();\n        this.set_width();\n        this.set_scroll_position();\n    }\n\n    setup_layers() {\n        this.layers = {};\n        const layers = ['grid', 'date', 'arrow', 'progress', 'bar', 'details'];\n        // make group layers\n        for (let layer of layers) {\n            this.layers[layer] = createSVG('g', {\n                class: layer,\n                append_to: this.$svg\n            });\n        }\n    }\n\n    make_grid() {\n        this.make_grid_background();\n        this.make_grid_rows();\n        this.make_grid_header();\n        this.make_grid_ticks();\n        this.make_grid_highlights();\n    }\n\n    make_grid_background() {\n        const grid_width = this.dates.length * this.options.column_width;\n        const grid_height =\n            this.options.header_height +\n            this.options.padding +\n            (this.options.bar_height + this.options.padding) *\n                this.tasks.length;\n\n        createSVG('rect', {\n            x: 0,\n            y: 0,\n            width: grid_width,\n            height: grid_height,\n            class: 'grid-background',\n            append_to: this.layers.grid\n        });\n\n        $.attr(this.$svg, {\n            height: grid_height + this.options.padding + 100,\n            width: '100%'\n        });\n    }\n\n    make_grid_rows() {\n        const rows_layer = createSVG('g', { append_to: this.layers.grid });\n        const lines_layer = createSVG('g', { append_to: this.layers.grid });\n\n        const row_width = this.dates.length * this.options.column_width;\n        const row_height = this.options.bar_height + this.options.padding;\n\n        let row_y = this.options.header_height + this.options.padding / 2;\n\n        for (let task of this.tasks) {\n            createSVG('rect', {\n                x: 0,\n                y: row_y,\n                width: row_width,\n                height: row_height,\n                class: 'grid-row',\n                append_to: rows_layer\n            });\n\n            createSVG('line', {\n                x1: 0,\n                y1: row_y + row_height,\n                x2: row_width,\n                y2: row_y + row_height,\n                class: 'row-line',\n                append_to: lines_layer\n            });\n\n            row_y += this.options.bar_height + this.options.padding;\n        }\n    }\n\n    make_grid_header() {\n        const header_width = this.dates.length * this.options.column_width;\n        const header_height = this.options.header_height + 10;\n        createSVG('rect', {\n            x: 0,\n            y: 0,\n            width: header_width,\n            height: header_height,\n            class: 'grid-header',\n            append_to: this.layers.grid\n        });\n    }\n\n    make_grid_ticks() {\n        let tick_x = 0;\n        let tick_y = this.options.header_height + this.options.padding / 2;\n        let tick_height =\n            (this.options.bar_height + this.options.padding) *\n            this.tasks.length;\n\n        for (let date of this.dates) {\n            let tick_class = 'tick';\n            // thick tick for monday\n            if (this.view_is('Day') && date.getDate() === 1) {\n                tick_class += ' thick';\n            }\n            // thick tick for first week\n            if (\n                this.view_is('Week') &&\n                date.getDate() >= 1 &&\n                date.getDate() < 8\n            ) {\n                tick_class += ' thick';\n            }\n            // thick ticks for quarters\n            if (this.view_is('Month') && (date.getMonth() + 1) % 3 === 0) {\n                tick_class += ' thick';\n            }\n\n            createSVG('path', {\n                d: `M ${tick_x} ${tick_y} v ${tick_height}`,\n                class: tick_class,\n                append_to: this.layers.grid\n            });\n\n            if (this.view_is('Month')) {\n                tick_x +=\n                    date_utils.get_days_in_month(date) *\n                    this.options.column_width /\n                    30;\n            } else {\n                tick_x += this.options.column_width;\n            }\n        }\n    }\n\n    make_grid_highlights() {\n        // highlight today's date\n        if (this.view_is('Day')) {\n            const x =\n                date_utils.diff(date_utils.today(), this.gantt_start, 'hour') /\n                this.options.step *\n                this.options.column_width;\n            const y = 0;\n\n            const width = this.options.column_width;\n            const height =\n                (this.options.bar_height + this.options.padding) *\n                    this.tasks.length +\n                this.options.header_height +\n                this.options.padding / 2;\n\n            createSVG('rect', {\n                x,\n                y,\n                width,\n                height,\n                class: 'today-highlight',\n                append_to: this.layers.grid\n            });\n        }\n    }\n\n    make_dates() {\n        for (let date of this.get_dates_to_draw()) {\n            createSVG('text', {\n                x: date.lower_x,\n                y: date.lower_y,\n                innerHTML: date.lower_text,\n                class: 'lower-text',\n                append_to: this.layers.date\n            });\n\n            if (date.upper_text) {\n                const $upper_text = createSVG('text', {\n                    x: date.upper_x,\n                    y: date.upper_y,\n                    innerHTML: date.upper_text,\n                    class: 'upper-text',\n                    append_to: this.layers.date\n                });\n\n                // remove out-of-bound dates\n                if (\n                    $upper_text.getBBox().x2 > this.layers.grid.getBBox().width\n                ) {\n                    $upper_text.remove();\n                }\n            }\n        }\n    }\n\n    get_dates_to_draw() {\n        let last_date = null;\n        const dates = this.dates.map((date, i) => {\n            const d = this.get_date_info(date, last_date, i);\n            last_date = date;\n            return d;\n        });\n        return dates;\n    }\n\n    get_date_info(date, last_date, i) {\n        if (!last_date) {\n            last_date = date_utils.add(date, 1, 'year');\n        }\n        const date_text = {\n            'Quarter Day_lower': date_utils.format(date, 'HH'),\n            'Half Day_lower': date_utils.format(date, 'HH'),\n            Day_lower:\n                date.getDate() !== last_date.getDate()\n                    ? date_utils.format(date, 'D')\n                    : '',\n            Week_lower:\n                date.getMonth() !== last_date.getMonth()\n                    ? date_utils.format(date, 'D MMM')\n                    : date_utils.format(date, 'D'),\n            Month_lower: date_utils.format(date, 'MMMM'),\n            'Quarter Day_upper':\n                date.getDate() !== last_date.getDate()\n                    ? date_utils.format(date, 'D MMM')\n                    : '',\n            'Half Day_upper':\n                date.getDate() !== last_date.getDate()\n                    ? date.getMonth() !== last_date.getMonth()\n                      ? date_utils.format(date, 'D MMM')\n                      : date_utils.format(date, 'D')\n                    : '',\n            Day_upper:\n                date.getMonth() !== last_date.getMonth()\n                    ? date_utils.format(date, 'MMMM')\n                    : '',\n            Week_upper:\n                date.getMonth() !== last_date.getMonth()\n                    ? date_utils.format(date, 'MMMM')\n                    : '',\n            Month_upper:\n                date.getFullYear() !== last_date.getFullYear()\n                    ? date_utils.format(date, 'YYYY')\n                    : ''\n        };\n\n        const base_pos = {\n            x: i * this.options.column_width,\n            lower_y: this.options.header_height,\n            upper_y: this.options.header_height - 25\n        };\n\n        const x_pos = {\n            'Quarter Day_lower': this.options.column_width * 4 / 2,\n            'Quarter Day_upper': 0,\n            'Half Day_lower': this.options.column_width * 2 / 2,\n            'Half Day_upper': 0,\n            Day_lower: this.options.column_width / 2,\n            Day_upper: this.options.column_width * 30 / 2,\n            Week_lower: 0,\n            Week_upper: this.options.column_width * 4 / 2,\n            Month_lower: this.options.column_width / 2,\n            Month_upper: this.options.column_width * 12 / 2\n        };\n\n        return {\n            upper_text: date_text[`${this.options.view_mode}_upper`],\n            lower_text: date_text[`${this.options.view_mode}_lower`],\n            upper_x: base_pos.x + x_pos[`${this.options.view_mode}_upper`],\n            upper_y: base_pos.upper_y,\n            lower_x: base_pos.x + x_pos[`${this.options.view_mode}_lower`],\n            lower_y: base_pos.lower_y\n        };\n    }\n\n    make_bars() {\n        this.bars = this.tasks.map(task => {\n            const bar = new Bar(this, task);\n            this.layers.bar.appendChild(bar.group);\n            return bar;\n        });\n    }\n\n    make_arrows() {\n        this.arrows = [];\n        for (let task of this.tasks) {\n            let arrows = [];\n            arrows = task.dependencies\n                .map(task_id => {\n                    const dependency = this.get_task(task_id);\n                    if (!dependency) return;\n                    const arrow = new Arrow(\n                        this,\n                        this.bars[dependency._index], // from_task\n                        this.bars[task._index] // to_task\n                    );\n                    this.layers.arrow.appendChild(arrow.element);\n                    return arrow;\n                })\n                .filter(Boolean); // filter falsy values\n            this.arrows = this.arrows.concat(arrows);\n        }\n    }\n\n    map_arrows_on_bars() {\n        for (let bar of this.bars) {\n            bar.arrows = this.arrows.filter(arrow => {\n                return (\n                    arrow.from_task.task.id === bar.task.id ||\n                    arrow.to_task.task.id === bar.task.id\n                );\n            });\n        }\n    }\n\n    set_width() {\n        const cur_width = this.$svg.getBoundingClientRect().width;\n        const actual_width = this.$svg\n            .querySelector('.grid .grid-row')\n            .getAttribute('width');\n        if (cur_width < actual_width) {\n            this.$svg.setAttribute('width', actual_width);\n        }\n    }\n\n    set_scroll_position() {\n        const parent_element = this.$svg.parentElement;\n        if (!parent_element) return;\n\n        const hours_before_first_task = date_utils.diff(\n            this.get_oldest_starting_date(),\n            this.gantt_start,\n            'hour'\n        );\n\n        const scroll_pos =\n            hours_before_first_task /\n                this.options.step *\n                this.options.column_width -\n            this.options.column_width;\n\n        parent_element.scrollLeft = scroll_pos;\n    }\n\n    bind_grid_click() {\n        $.on(\n            this.$svg,\n            this.options.popup_trigger,\n            '.grid-row, .grid-header',\n            () => {\n                this.unselect_all();\n                this.hide_popup();\n            }\n        );\n    }\n\n    bind_bar_events() {\n        let is_dragging = false;\n        let x_on_start = 0;\n        let y_on_start = 0;\n        let is_resizing_left = false;\n        let is_resizing_right = false;\n        let parent_bar_id = null;\n        let bars = []; // instanceof Bar\n        this.bar_being_dragged = null;\n\n        function action_in_progress() {\n            return is_dragging || is_resizing_left || is_resizing_right;\n        }\n\n        $.on(this.$svg, 'mousedown', '.bar-wrapper, .handle', (e, element) => {\n            const bar_wrapper = $.closest('.bar-wrapper', element);\n\n            if (element.classList.contains('left')) {\n                is_resizing_left = true;\n            } else if (element.classList.contains('right')) {\n                is_resizing_right = true;\n            } else if (element.classList.contains('bar-wrapper')) {\n                is_dragging = true;\n            }\n\n            bar_wrapper.classList.add('active');\n\n            x_on_start = e.offsetX;\n            y_on_start = e.offsetY;\n\n            parent_bar_id = bar_wrapper.getAttribute('data-id');\n            const ids = [\n                parent_bar_id,\n                ...this.get_all_dependent_tasks(parent_bar_id)\n            ];\n            bars = ids.map(id => this.get_bar(id));\n\n            this.bar_being_dragged = parent_bar_id;\n\n            bars.forEach(bar => {\n                const $bar = bar.$bar;\n                $bar.ox = $bar.getX();\n                $bar.oy = $bar.getY();\n                $bar.owidth = $bar.getWidth();\n                $bar.finaldx = 0;\n            });\n        });\n\n        $.on(this.$svg, 'mousemove', e => {\n            if (!action_in_progress()) return;\n            const dx = e.offsetX - x_on_start;\n            const dy = e.offsetY - y_on_start;\n\n            bars.forEach(bar => {\n                const $bar = bar.$bar;\n                $bar.finaldx = this.get_snap_position(dx);\n\n                if (is_resizing_left) {\n                    if (parent_bar_id === bar.task.id) {\n                        bar.update_bar_position({\n                            x: $bar.ox + $bar.finaldx,\n                            width: $bar.owidth - $bar.finaldx\n                        });\n                    } else {\n                        bar.update_bar_position({\n                            x: $bar.ox + $bar.finaldx\n                        });\n                    }\n                } else if (is_resizing_right) {\n                    if (parent_bar_id === bar.task.id) {\n                        bar.update_bar_position({\n                            width: $bar.owidth + $bar.finaldx\n                        });\n                    }\n                } else if (is_dragging) {\n                    bar.update_bar_position({ x: $bar.ox + $bar.finaldx });\n                }\n            });\n        });\n\n        document.addEventListener('mouseup', e => {\n            if (is_dragging || is_resizing_left || is_resizing_right) {\n                bars.forEach(bar => bar.group.classList.remove('active'));\n            }\n\n            is_dragging = false;\n            is_resizing_left = false;\n            is_resizing_right = false;\n        });\n\n        $.on(this.$svg, 'mouseup', e => {\n            this.bar_being_dragged = null;\n            bars.forEach(bar => {\n                const $bar = bar.$bar;\n                if (!$bar.finaldx) return;\n                bar.date_changed();\n                bar.set_action_completed();\n            });\n        });\n\n        this.bind_bar_progress();\n    }\n\n    bind_bar_progress() {\n        let x_on_start = 0;\n        let y_on_start = 0;\n        let is_resizing = null;\n        let bar = null;\n        let $bar_progress = null;\n        let $bar = null;\n\n        $.on(this.$svg, 'mousedown', '.handle.progress', (e, handle) => {\n            is_resizing = true;\n            x_on_start = e.offsetX;\n            y_on_start = e.offsetY;\n\n            const $bar_wrapper = $.closest('.bar-wrapper', handle);\n            const id = $bar_wrapper.getAttribute('data-id');\n            bar = this.get_bar(id);\n\n            $bar_progress = bar.$bar_progress;\n            $bar = bar.$bar;\n\n            $bar_progress.finaldx = 0;\n            $bar_progress.owidth = $bar_progress.getWidth();\n            $bar_progress.min_dx = -$bar_progress.getWidth();\n            $bar_progress.max_dx = $bar.getWidth() - $bar_progress.getWidth();\n        });\n\n        $.on(this.$svg, 'mousemove', e => {\n            if (!is_resizing) return;\n            let dx = e.offsetX - x_on_start;\n            let dy = e.offsetY - y_on_start;\n\n            if (dx > $bar_progress.max_dx) {\n                dx = $bar_progress.max_dx;\n            }\n            if (dx < $bar_progress.min_dx) {\n                dx = $bar_progress.min_dx;\n            }\n\n            const $handle = bar.$handle_progress;\n            $.attr($bar_progress, 'width', $bar_progress.owidth + dx);\n            $.attr($handle, 'points', bar.get_progress_polygon_points());\n            $bar_progress.finaldx = dx;\n        });\n\n        $.on(this.$svg, 'mouseup', () => {\n            is_resizing = false;\n            if (!($bar_progress && $bar_progress.finaldx)) return;\n            bar.progress_changed();\n            bar.set_action_completed();\n        });\n    }\n\n    get_all_dependent_tasks(task_id) {\n        let out = [];\n        let to_process = [task_id];\n        while (to_process.length) {\n            const deps = to_process.reduce((acc, curr) => {\n                acc = acc.concat(this.dependency_map[curr]);\n                return acc;\n            }, []);\n\n            out = out.concat(deps);\n            to_process = deps.filter(d => !to_process.includes(d));\n        }\n\n        return out.filter(Boolean);\n    }\n\n    get_snap_position(dx) {\n        let odx = dx,\n            rem,\n            position;\n\n        if (this.view_is('Week')) {\n            rem = dx % (this.options.column_width / 7);\n            position =\n                odx -\n                rem +\n                (rem < this.options.column_width / 14\n                    ? 0\n                    : this.options.column_width / 7);\n        } else if (this.view_is('Month')) {\n            rem = dx % (this.options.column_width / 30);\n            position =\n                odx -\n                rem +\n                (rem < this.options.column_width / 60\n                    ? 0\n                    : this.options.column_width / 30);\n        } else {\n            rem = dx % this.options.column_width;\n            position =\n                odx -\n                rem +\n                (rem < this.options.column_width / 2\n                    ? 0\n                    : this.options.column_width);\n        }\n        return position;\n    }\n\n    unselect_all() {\n        [...this.$svg.querySelectorAll('.bar-wrapper')].forEach(el => {\n            el.classList.remove('active');\n        });\n    }\n\n    view_is(modes) {\n        if (typeof modes === 'string') {\n            return this.options.view_mode === modes;\n        }\n\n        if (Array.isArray(modes)) {\n            return modes.some(mode => this.options.view_mode === mode);\n        }\n\n        return false;\n    }\n\n    get_task(id) {\n        return this.tasks.find(task => {\n            return task.id === id;\n        });\n    }\n\n    get_bar(id) {\n        return this.bars.find(bar => {\n            return bar.task.id === id;\n        });\n    }\n\n    show_popup(options) {\n        if (!this.popup) {\n            this.popup = new Popup(\n                this.popup_wrapper,\n                this.options.custom_popup_html\n            );\n        }\n        this.popup.show(options);\n    }\n\n    hide_popup() {\n        this.popup && this.popup.hide();\n    }\n\n    trigger_event(event, args) {\n        if (this.options['on_' + event]) {\n            this.options['on_' + event].apply(null, args);\n        }\n    }\n\n    /**\n     * Gets the oldest starting date from the list of tasks\n     *\n     * @returns Date\n     * @memberof Gantt\n     */\n    get_oldest_starting_date() {\n        return this.tasks\n            .map(task => task._start)\n            .reduce(\n                (prev_date, cur_date) =>\n                    cur_date <= prev_date ? cur_date : prev_date\n            );\n    }\n\n    /**\n     * Clear all elements from the parent svg element\n     *\n     * @memberof Gantt\n     */\n    clear() {\n        this.$svg.innerHTML = '';\n    }\n}\n\nfunction generate_id(task) {\n    return (\n        task.name +\n        '_' +\n        Math.random()\n            .toString(36)\n            .slice(2, 12)\n    );\n}\n"]},"metadata":{},"sourceType":"module"}